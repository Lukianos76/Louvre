{% extends 'base.html.twig' %}

{% block title 'Reserver vos billets' %}

{% block body %}
<div class="container">

    <div id="smartwizard">
        <ul>
            <li>
                <a href="#step-1">
                    <div class="circle">1</div>
                    <br/>
                    <div class="circle-label">Panier</div>
                </a></li>
            <li>
                <a href="#step-2">
                    <div class="circle">2</div>
                    <br/>
                    <div class="circle-label">Coordonn√©es</div>
                </a></li>
            <li>
                <a href="#step-3">
                    <div class="circle">3</div>
                    <br/>
                    <div class="circle-label">Paiement</div>
                </a></li>
            <li>
        </ul>


        <div>
            {{ form_start(form, {'attr': {'id': 'booking'}}) }}
            {{ include('formstep/step1.html.twig') }}
            {{ include('formstep/step2.html.twig') }}
            {{ include('formstep/step3.html.twig') }}
            <div class="hidden">{{ form_rest(form) }}</div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
    {% endblock %}

{% block javascripts %}

    <script>

        $( document ).ready(function () {
            $("#ticketDate-feedback").hide();
            $("#myTickets-feedback").hide();
            $(".btn-toolbar").hide();
            $("#step-2").hide();
            $("#step-3").hide();
        })


        var myBooking = new booking();

        $("#smartwizard").on("leaveStep", function(e, anchorObject, stepNumber, stepDirection) {
            if (stepNumber == 0 && stepDirection == 'forward'){
                if(checkDate($('#book_ticketDate').val()))
                {
                    myBooking.ticketDate = $('#book_ticketDate').val();
                    myBooking.type = $('#book_type').val();
                    console.log(myBooking);
                }
                else{
                    e.preventDefault();
                }

            }
            else if(stepNumber == 1 && stepDirection == 'forward'){
                if (typeof myTickets == 'undefined' || myTickets.length <= 0) {
                    console.log('test')
                    e.preventDefault();
                    $("#myTickets-feedback").show();
                }
                else{
                    $("#myTickets-feedback").hide();
                    myBooking.tickets = myTickets;
                    var ticketsNumber = Object.entries(myTickets).length;
                    myBooking.price = 0;

                    for (var i = 0; i < ticketsNumber; i++) {
                        ticketName = Object.keys(Object.entries(myTickets)[i][1])[0]
                        console.log(ticketName)
                        myBooking.price = myBooking.price + Object.entries(myTickets)[i][1][ticketName].price;
                    }
                    $('#total-price').text(myBooking.price / 100)
                }
            }
            else if(stepNumber == 2 && stepDirection == 'forward'){
            }
        });
        

        function booking() {
            this.price = 0;
        }

        function checkDate(ticketDate) {
            var isValid = false;

            if (ticketDate.length < 10){
                isValid = false;
                $("#ticketDate-feedback").show();
                $('#book_ticketDate').addClass("invalid")

            }
            else{
                isValid = true
                $("#ticketDate-feedback").hide();
                $('#book_ticketDate').removeClass("invalid")
            }

            return isValid
        }

    </script>
{% endblock %}